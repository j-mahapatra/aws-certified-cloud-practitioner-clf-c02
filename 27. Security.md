# Defense in Depth

**Defense in Depth** is a **security strategy** that uses **multiple layers of defense** to protect systems, data, and infrastructure. The idea is that if one layer is breached, **other layers still provide protection**.

It’s like securing a castle: even if an attacker gets past the moat, they still face walls, gates, guards, and inner barriers.

## Why Is It Important?

- **Reduces risk** of a single point of failure
- **Delays attackers**, increasing chance of detection and response
- **Protects assets** at every level: network, application, data, identity
- **Complies with security best practices** and frameworks (e.g., NIST, CIS)

## Core Layers of Defense in Depth (Cloud Perspective)

| Layer                         | What It Covers                                   | AWS Examples                                      |
| ----------------------------- | ------------------------------------------------ | ------------------------------------------------- |
| **Physical Security**         | Data center access, hardware protection          | AWS-managed physical security at facilities       |
| **Network Security**          | Isolation, firewalls, segmentation               | VPC, Security Groups, NACLs, AWS WAF              |
| **Perimeter Security**        | Preventing unauthorized access at entry points   | API Gateway throttling, AWS Shield, WAF           |
| **Endpoint Security**         | Device protection (laptops, servers, containers) | EC2 hardening, Inspector, SSM, GuardDuty          |
| **Application Security**      | Secure code, validation, runtime protection      | AWS CodePipeline + CodeGuru, Cognito, WAF         |
| **Identity & Access Control** | Authentication, authorization, MFA               | IAM, IAM Roles, AWS SSO, AWS Organizations        |
| **Data Protection**           | Encryption, tokenization, masking                | KMS, S3 encryption, Secrets Manager               |
| **Monitoring & Logging**      | Detection and alerts                             | CloudTrail, CloudWatch, GuardDuty, Config         |
| **Security Automation**       | Remediation, response                            | AWS Config Rules, Lambda auto-remediation         |
| **User Training**             | Phishing awareness, secure practices             | Internal policies, AWS training and certification |

## Defense in Depth in AWS: Example

Let’s say you host a web application on AWS. Here’s how multiple layers protect it:

1. **Network Isolation**: App runs in a private subnet within a VPC
2. **Firewall**: Security groups only allow HTTP/HTTPS to the web tier
3. **WAF**: AWS WAF filters bad web traffic (e.g., SQL injection)
4. **IAM Roles**: EC2 instances get only minimal required permissions
5. **Data Encryption**: S3 bucket stores data encrypted with KMS
6. **CloudTrail**: Logs all API activity for auditing
7. **GuardDuty**: Detects anomalies like SSH brute-force attempts
8. **Budgets & Billing Alerts**: Alert for unexpected usage from attacks

## Best Practices

- Use **least privilege** access for users and services
- **Encrypt data** in transit and at rest
- Regularly **review security configurations**
- Enable **logging and monitoring**
- Implement **incident response playbooks**
- Apply **patch management** and vulnerability scans
- Train developers and employees on secure practices

## Summary

| Concept   | Description                                           |
| --------- | ----------------------------------------------------- |
| Strategy  | Multiple independent layers of security               |
| Goal      | Reduce attack surface, detect and delay breaches      |
| Benefit   | Increases overall resilience of cloud environments    |
| Cloud Fit | Aligns with shared responsibility model and AWS tools |

## Related AWS Services

- **IAM**, **AWS WAF**, **Shield**, **CloudTrail**, **GuardDuty**
- **Amazon Inspector**, **AWS Config**, **KMS**, **Secrets Manager**
- **Control Tower**, **Security Hub**, **CodePipeline** (secure CI/CD)

# The CIA Triad: Confidentiality, Integrity, and Availability

The **CIA Triad** is a foundational model in **information security** that defines the **three core principles** for securing data and systems:

1. **Confidentiality**
2. **Integrity**
3. **Availability**

These principles guide the design, implementation, and evaluation of security controls, policies, and systems. Together, they ensure that **information is protected, reliable, and accessible when needed**.

## 1. Confidentiality

### Definition:

**Confidentiality** ensures that **information is not disclosed** to unauthorized individuals, systems, or processes.

### Key Concepts:

- Prevents **data leaks** and **unauthorized access**
- Applies to data **at rest, in transit, and in use**
- Ensures **privacy and data classification compliance**

### Common Controls:

- **Encryption** (e.g., AES, TLS)
- **IAM policies** and **role-based access control**
- **Multi-factor authentication (MFA)**
- **Network segmentation**
- **Data masking and tokenization**

### Example:

- Encrypting customer data stored in Amazon S3 with AWS KMS so only authorized applications can access it.

## 2. Integrity

### Definition:

**Integrity** ensures that **information is accurate and unaltered**, whether in storage, in transit, or during processing.

### Key Concepts:

- Protects against **unauthorized modification or deletion**
- Enables **trust in data** for decision-making
- Includes **data validation and verification**

### Common Controls:

- **Checksums and hash functions** (e.g., SHA-256)
- **Digital signatures**
- **Version control**
- **Write-once storage** (e.g., Amazon S3 Object Lock)
- **Audit logs and change tracking** (e.g., CloudTrail)

### Example:

- Using Amazon CloudTrail to monitor and log changes to IAM roles, ensuring unauthorized changes are detected.

## 3. Availability

### Definition:

**Availability** ensures that **information and systems are accessible** and usable by authorized users when needed.

### Key Concepts:

- Prevents **downtime**, **denial of service**, and **data loss**
- Includes both **high availability** and **disaster recovery**

### Common Controls:

- **Load balancing** and **Auto Scaling**
- **Redundant systems** and **multi-AZ deployments**
- **Backups and snapshots** (e.g., Amazon RDS backups)
- **DDoS protection** (e.g., AWS Shield)
- **Failover mechanisms** and **health checks**

### Example:

- Deploying a web application across multiple AWS Availability Zones to maintain uptime even during infrastructure failure.

## Summary Table

| Principle       | Goal                             | Example AWS Services/Practices              |
| --------------- | -------------------------------- | ------------------------------------------- |
| Confidentiality | Keep data secret                 | KMS, IAM, TLS, Secrets Manager              |
| Integrity       | Keep data accurate and unaltered | CloudTrail, hash checks, S3 Object Lock     |
| Availability    | Keep data accessible             | ELB, Auto Scaling, RDS Multi-AZ, AWS Shield |

## Why the CIA Triad Matters

- It's used in **risk assessment**, **security architecture**, and **compliance frameworks**
- Guides organizations in **prioritizing controls** based on data sensitivity and risk tolerance
- Forms the **backbone of modern cybersecurity standards** like ISO 27001, NIST 800-53, and SOC 2

## Real-World Example in AWS

Imagine a healthcare app hosted on AWS:

- **Confidentiality**: Patient records are encrypted in S3 and access is limited via IAM roles.
- **Integrity**: All data writes to DynamoDB are logged and versioned for traceability.
- **Availability**: The app runs in a multi-AZ ECS cluster with load balancing and automatic failover.

Together, these safeguards enforce **strong security and resilience**, aligned with the CIA Triad.

# Vulnerabilities

A **security vulnerability** is a **weakness or flaw** in a system, software, configuration, or process that could be exploited by a threat actor to gain **unauthorized access**, **disrupt services**, **steal data**, or **perform malicious actions**.

Vulnerabilities may exist due to **code errors**, **misconfigurations**, **lack of updates**, or **inadequate access controls**.

## Categories of Security Vulnerabilities

### 1. **Software Vulnerabilities**

- Bugs or flaws in application or system code
- Can be exploited to run arbitrary code, access memory, or crash systems

**Examples:**

- Buffer overflow
- Remote code execution (RCE)
- SQL injection (SQLi)
- Cross-site scripting (XSS)

### 2. **Configuration Vulnerabilities**

- Weaknesses due to insecure system or cloud settings

**Examples:**

- Open S3 buckets
- Insecure security group rules (e.g., open port 22 to the world)
- Default passwords or unused accounts
- Over-permissive IAM roles

### 3. **Authentication and Access Control Flaws**

- Weak or missing authentication mechanisms

**Examples:**

- No multi-factor authentication (MFA)
- Reuse of passwords
- Hardcoded credentials in source code
- Unrestricted use of IAM roles or policies

### 4. **Network Vulnerabilities**

- Weaknesses in how data moves across systems

**Examples:**

- Unencrypted traffic (no TLS/SSL)
- Open ports and protocols
- Lack of network segmentation
- Susceptibility to man-in-the-middle (MITM) attacks

### 5. **User-Related Vulnerabilities**

- Human errors that introduce risks

**Examples:**

- Phishing attacks
- Social engineering
- Accidental data exposure (e.g., misconfigured sharing)
- Improper handling of secrets

## Common Examples in AWS Context

| Vulnerability                    | Description                               | AWS Mitigation Tools                     |
| -------------------------------- | ----------------------------------------- | ---------------------------------------- |
| Open S3 bucket                   | Data publicly accessible without controls | Block Public Access, S3 ACLs             |
| Over-permissive IAM policy       | Wildcard `"*"` in IAM permissions         | IAM Access Analyzer, Policy Simulator    |
| Public EC2 SSH port              | Port 22 open to 0.0.0.0/0                 | Security Groups, VPC, AWS Inspector      |
| Outdated AMI or packages         | EC2 running vulnerable software           | Systems Manager Patch Manager, Inspector |
| No encryption for sensitive data | Plaintext in transit or at rest           | KMS, S3 SSE, EBS Encryption              |

## How Vulnerabilities Are Discovered

- **Manual code reviews**
- **Penetration testing**
- **Automated vulnerability scanners** (e.g., Amazon Inspector)
- **Threat intelligence feeds**
- **Bug bounty programs**
- **Monitoring and logging tools**

## How to Mitigate Security Vulnerabilities

1. **Apply security patches and updates** regularly
2. **Use the principle of least privilege** (PoLP) for access
3. **Enable MFA** and strong authentication
4. **Encrypt data** at rest and in transit
5. **Audit logs and monitor activity** with tools like CloudTrail and GuardDuty
6. **Perform regular security reviews** and use automated scanning
7. **Use security baselines and compliance checks** (e.g., AWS Config rules)

## Related AWS Services

| AWS Service                 | Purpose                                     |
| --------------------------- | ------------------------------------------- |
| **Amazon Inspector**        | Automated vulnerability management          |
| **AWS Config**              | Detects resource misconfigurations          |
| **AWS IAM Access Analyzer** | Finds overly broad permissions              |
| **AWS GuardDuty**           | Detects anomalies and threats               |
| **AWS CloudTrail**          | Audits API activity                         |
| **AWS Security Hub**        | Centralizes and prioritizes security alerts |

## Summary

| Aspect                | Description                                              |
| --------------------- | -------------------------------------------------------- |
| Definition            | A flaw that can be exploited for unauthorized action     |
| Sources               | Code, misconfig, network, user behavior                  |
| Risks                 | Data loss, breaches, downtime, compliance failures       |
| Mitigation Strategies | Patch, limit access, encryption, monitoring, scanning    |
| AWS Tools             | Inspector, Config, IAM Analyzer, GuardDuty, Security Hub |

## OWASP Top 10 Web Application Vulnerabilities (2021)

The **OWASP Top 10** is a standard awareness document for developers and security professionals. It represents the **most critical web application security risks** based on data from real-world applications and expert analysis.

| Rank | Vulnerability Name                       | Risk Focus                                |
| ---- | ---------------------------------------- | ----------------------------------------- |
| A01  | Broken Access Control                    | Unauthorized access                       |
| A02  | Cryptographic Failures                   | Data protection                           |
| A03  | Injection                                | Code execution via untrusted input        |
| A04  | Insecure Design                          | Weak architecture and logic               |
| A05  | Security Misconfiguration                | Misconfigured services and apps           |
| A06  | Vulnerable & Outdated Components         | Known-vulnerable dependencies             |
| A07  | Identification & Authentication Failures | Weak login/session controls               |
| A08  | Software & Data Integrity Failures       | CI/CD, updates, and supply chain issues   |
| A09  | Security Logging & Monitoring Failures   | Lack of detection/alerting                |
| A10  | Server-Side Request Forgery (SSRF)       | Server abusing internal network resources |

# Encryption

**Encryption** is the process of converting **readable data (plaintext)** into an **unreadable format (ciphertext)** using a mathematical algorithm and a **key**, to protect it from unauthorized access.

Only someone with the correct **decryption key** can revert the ciphertext back to plaintext.

## Why Encryption Matters

- Ensures **confidentiality** of data
- Protects against **data breaches and leaks**
- Supports **compliance** (e.g., HIPAA, GDPR, PCI-DSS)
- Secures **data at rest, in transit, and in use**
- Essential for **zero trust** and **cloud-native security models**

## Types of Encryption

### 1. **Symmetric Encryption**

- Same key is used to **encrypt and decrypt**
- Fast and efficient

**Examples**:

- AES (Advanced Encryption Standard)
- Blowfish

**Use Case**: Data-at-rest encryption (e.g., S3, EBS, RDS)

### 2. **Asymmetric Encryption**

- Uses a **public key** to encrypt and a **private key** to decrypt
- Slower but more secure for data exchange

**Examples**:

- RSA
- ECC (Elliptic Curve Cryptography)

**Use Case**: TLS/SSL, digital signatures, secure key exchange

### 3. **Hashing (One-Way Encryption)**

- Irreversible transformation of data into a fixed-length value
- Used for **integrity verification**, not confidentiality

**Examples**:

- SHA-256, MD5 (not recommended for security)

**Use Case**: Password storage, digital signatures

## Data Protection Layers

| Layer          | Encryption Type        | Example Tools/Tech       |
| -------------- | ---------------------- | ------------------------ |
| **At Rest**    | Symmetric              | AES-256, AWS KMS, S3 SSE |
| **In Transit** | Asymmetric + Symmetric | TLS/SSL, HTTPS, VPNs     |
| **In Use**     | Homomorphic / Enclaves | AWS Nitro Enclaves, TEEs |

## Encryption in AWS

AWS provides **native encryption capabilities** across nearly all services. Most use **AES-256** with optional key management through:

### 1. **AWS Key Management Service (KMS)**

- Centralized key creation and management
- Integrated with S3, EBS, RDS, DynamoDB, Lambda, and more
- Supports **Customer Managed Keys (CMK)** and **AWS Managed Keys**

### 2. **AWS CloudHSM**

- Dedicated **hardware security module** (HSM)
- For use cases requiring **FIPS 140-2 Level 3 compliance**

### 3. **Service-Specific Encryption**

| Service    | Encryption Options                             |
| ---------- | ---------------------------------------------- |
| Amazon S3  | SSE-S3, SSE-KMS, SSE-C, client-side encryption |
| Amazon EBS | Default encryption with KMS keys               |
| Amazon RDS | Transparent Data Encryption (TDE), KMS         |
| DynamoDB   | Encryption at rest with AWS KMS                |
| SQS/SNS    | Message encryption via KMS                     |

## Encryption Best Practices

- Use **encryption by default** for all sensitive data
- Rotate encryption keys regularly (automate with AWS KMS)
- Limit access to keys using **IAM and resource policies**
- Monitor key usage and API calls with **CloudTrail**
- Use **TLS** for all data transmission
- Store secrets in **Secrets Manager** or **Parameter Store**

## Summary

| Concept     | Description                                            |
| ----------- | ------------------------------------------------------ |
| Encryption  | Transforms data to protect it from unauthorized access |
| Key Types   | Symmetric (AES), Asymmetric (RSA), Hash (SHA-256)      |
| Data States | Encrypt at rest, in transit, and optionally in use     |
| AWS Tools   | KMS, CloudHSM, S3 SSE, RDS TDE, TLS                    |
| Use Cases   | Data protection, compliance, secure communications     |

## Related AWS Services

- **AWS KMS** – Key management and encryption integration
- **AWS CloudHSM** – Hardware security module
- **AWS Secrets Manager** – Securely store and rotate secrets
- **AWS Certificate Manager (ACM)** – Manage TLS certificates

# Ciphers (Cyphers)

A **cipher** is a **mathematical algorithm** used to **encrypt** (convert plaintext into ciphertext) and **decrypt** (convert ciphertext back into plaintext) data. Ciphers are the **core component of encryption**, helping protect the confidentiality of information.

The strength and design of a cipher determine how secure the encryption process is against unauthorized access or brute-force attacks.

## Key Components of a Cipher

| Component      | Description                                        |
| -------------- | -------------------------------------------------- |
| **Plaintext**  | The original, readable data                        |
| **Ciphertext** | The scrambled, unreadable output                   |
| **Key**        | A secret value that controls encryption/decryption |
| **Algorithm**  | The mathematical function used to transform data   |

## Types of Ciphers

### 1. **Substitution Cipher**

Replaces characters or bits in plaintext with different ones.

**Example**: Caesar Cipher – shift each letter by a fixed number (e.g., A → D)

**Not secure today**, but useful historically.

### 2. **Transposition Cipher**

Scrambles the order of characters in plaintext without changing them.

**Example**: "HELLO" → "OLEHL"

Often used with substitution in classical ciphers.

## Modern Cipher Categories

### 1. **Symmetric Ciphers**

- Use the **same key** for both encryption and decryption
- Fast and efficient, ideal for large data

**Common Symmetric Ciphers**:
| Cipher | Description |
|--------------|--------------------------------------|
| **AES** | Advanced Encryption Standard (very secure and widely used) |
| **DES/3DES** | Older ciphers, mostly deprecated |
| **ChaCha20** | Modern stream cipher, fast and secure|

Used in **data-at-rest** encryption like S3, EBS, RDS

### 2. **Asymmetric Ciphers**

- Use a **public key** to encrypt and a **private key** to decrypt
- Slower, but ideal for secure key exchange and digital signatures

**Common Asymmetric Ciphers**:
| Cipher | Description |
|--------------|--------------------------------------|
| **RSA** | Most widely used public-key algorithm |
| **ECC** | Elliptic Curve Cryptography – shorter keys, faster |

Used in **TLS**, **PKI**, and **digital certificates**

## Cipher Modes (for Block Ciphers like AES)

Block ciphers require **modes of operation** to securely encrypt larger chunks of data.

| Mode    | Description                                            |
| ------- | ------------------------------------------------------ |
| **ECB** | Encrypts blocks independently (insecure – avoid)       |
| **CBC** | Chained blocks with initialization vector              |
| **GCM** | Authenticated encryption (confidentiality + integrity) |
| **CTR** | Converts block cipher to stream cipher                 |

**AES-GCM** is the recommended modern mode for authenticated encryption.

## Ciphers in AWS

AWS uses strong, modern ciphers in its services by default. Examples:

| Use Case                  | Cipher Algorithm                          |
| ------------------------- | ----------------------------------------- |
| S3 encryption             | AES-256 with KMS                          |
| SSL/TLS on ALB/CloudFront | TLS 1.2+, with AES-GCM or ChaCha20        |
| KMS keys                  | AES-256 (symmetric), RSA/ECC (asymmetric) |
| Secrets Manager           | KMS-backed encryption                     |

## Summary

| Term           | Meaning                                                           |
| -------------- | ----------------------------------------------------------------- |
| Cipher         | Algorithm for encrypting and decrypting data                      |
| Symmetric      | One key used for both encryption and decryption                   |
| Asymmetric     | Public/private key pair used for secure communication             |
| Modern Ciphers | AES, ChaCha20, RSA, ECC                                           |
| Modes          | Define how block ciphers process multiple blocks (e.g., GCM, CBC) |

## Important Notes

- Use **AES-256-GCM** for most data-at-rest needs
- Use **TLS 1.2 or 1.3** with strong cipher suites for data in transit
- Avoid legacy ciphers like **RC4**, **DES**, or **ECB mode**

# Cryptographic Keys

A **cryptographic key** is a **random string of bits** used by a cryptographic algorithm to **encrypt or decrypt data**, **sign messages**, or **verify digital signatures**. It determines the **output** of the cryptographic function, ensuring **confidentiality**, **integrity**, and **authenticity** of data.

Think of a cryptographic key like a **password** that unlocks encryption, but generated mathematically and managed securely.

## Types of Cryptographic Keys

### 1. **Symmetric Keys**

- The **same key** is used for both **encryption** and **decryption**
- Fast and efficient for **large data volumes**
- Must be kept **secret between sender and receiver**

**Example Algorithms**: AES, ChaCha20

**Use Cases**:

- Data at rest (e.g., S3, RDS, EBS encryption)
- VPN traffic
- Disk-level encryption

### 2. **Asymmetric Keys (Public-Key Cryptography)**

- Uses a **key pair**:
  - **Public Key**: Used to **encrypt** or **verify**
  - **Private Key**: Used to **decrypt** or **sign**
- Only the **private key must be kept secret**

**Example Algorithms**: RSA, ECC

**Use Cases**:

- TLS/SSL certificates
- Email encryption (PGP)
- Secure key exchange
- Digital signatures

### 3. **Key Derivation Keys**

- Derived from other keys or passwords using functions like PBKDF2, bcrypt, or HKDF
- Used for generating keys from passwords or shared secrets

**Use Case**:

- User authentication systems
- Secure API token generation

## Key Length and Strength

- **Longer keys** = **more secure**, but slower
- Common key lengths:
  - AES: 128, 192, 256 bits
  - RSA: 2048 or 4096 bits
  - ECC: 256 or 384 bits (shorter but strong due to math)

**Note**: RSA-2048 is roughly equivalent in strength to AES-128.

## Key Management Principles

| Principle           | Description                                      |
| ------------------- | ------------------------------------------------ |
| **Confidentiality** | Keep private keys secret                         |
| **Integrity**       | Ensure keys aren't tampered with                 |
| **Rotation**        | Regularly update keys to reduce exposure risk    |
| **Separation**      | Use different keys for different functions       |
| **Access Control**  | Limit key access using IAM policies and auditing |

## Key Lifecycle

1. **Generate**: Create key material securely
2. **Store**: Save in a secure vault or HSM
3. **Use**: For encryption, decryption, signing, verification
4. **Rotate**: Periodically replace with new keys
5. **Retire**: Disable when no longer in use
6. **Destroy**: Securely erase key material

## Key Management in AWS

### AWS KMS (Key Management Service)

- Manages **symmetric and asymmetric keys**
- Automatically integrates with AWS services
- Supports:
  - **Customer Managed Keys (CMKs)**
  - **AWS Managed Keys**
  - **Key rotation**
  - **Access control with IAM**

### AWS CloudHSM

- Dedicated **hardware security module (HSM)**
- Full control over cryptographic keys
- Meets **FIPS 140-2 Level 3 compliance**

## Summary Table

| Key Type       | Direction             | Kept Secret  | Use Case                         |
| -------------- | --------------------- | ------------ | -------------------------------- |
| Symmetric Key  | One key for both      | Yes          | Data encryption at rest          |
| Asymmetric Key | Public + Private      | Private only | TLS, digital signatures          |
| Derived Key    | From password/secrets | Yes          | Authentication, secure token use |

## Best Practices

- Use **AES-256** for symmetric encryption
- Use **RSA-2048** or **ECC (P-256)** for asymmetric keys
- **Store keys securely** using KMS or HSMs
- **Rotate keys regularly**
- **Limit who can use and manage keys**
- Enable **CloudTrail** logging for key usage

# Hashing and Salting

## What Is Hashing?

**Hashing** is a **one-way cryptographic function** that converts any input (text, file, password) into a fixed-length string of characters, called a **hash** or **digest**.

- The same input will **always produce the same hash**
- It's **non-reversible** – you can't derive the original input from the hash
- A small change in input produces a **completely different hash**

### Use Cases:

- Storing passwords securely
- Data integrity verification
- Digital signatures
- Blockchain

### Common Hash Algorithms:

| Algorithm | Hash Length | Notes                          |
| --------- | ----------- | ------------------------------ |
| MD5       | 128-bit     | Fast, but **not secure**       |
| SHA-1     | 160-bit     | Deprecated (collision risk)    |
| SHA-256   | 256-bit     | Secure and widely used         |
| SHA-3     | 224–512-bit | Newer standard (NIST-approved) |

## What Is Salting?

**Salting** is the process of adding **random data (a salt)** to an input (like a password) before hashing it. This makes each hash **unique**, even if two users have the same password.

Without salting, attackers can use **precomputed tables** (like rainbow tables) to reverse-engineer common hashes.

### Example:

| Password   | Salt     | Hash (SHA-256)             |
| ---------- | -------- | -------------------------- |
| `password` | `abc123` | `f8a3...` (unique hash)    |
| `password` | `xyz789` | `e2b4...` (different hash) |

### Key Benefits:

- Prevents **rainbow table** attacks
- Makes **brute-force** attacks harder
- Ensures each user’s password hash is **unique**

## Hashing vs Encryption

| Feature    | Hashing                       | Encryption                    |
| ---------- | ----------------------------- | ----------------------------- |
| Direction  | One-way                       | Two-way (can decrypt)         |
| Purpose    | Verify data integrity         | Ensure data confidentiality   |
| Reversible | No                            | Yes                           |
| Use Case   | Passwords, digital signatures | File storage, network traffic |

## Best Practices for Password Hashing

- Use a **strong hashing algorithm** like SHA-256, bcrypt, scrypt, or Argon2
- Always add a **unique, random salt** per password
- Store the **salt alongside the hash** (safe to store since it's not secret)
- For better security, use **key-stretching algorithms** like:
  - **bcrypt**
  - **scrypt**
  - **Argon2** (preferred modern standard)

## Example: Secure Password Storage Flow

1. User enters password: `hunter2`
2. Generate random salt: `Zx8!p1@L`
3. Combine: `Zx8!p1@Lhunter2`
4. Hash the combination with SHA-256
5. Store:
   - Salt: `Zx8!p1@L`
   - Hashed password: `9aef0ac7b...`

To validate login, repeat steps 2–4 using the stored salt.

## Summary

| Concept  | Description                                     |
| -------- | ----------------------------------------------- |
| Hashing  | One-way function to create a fixed-size digest  |
| Salting  | Adding randomness to input before hashing       |
| Purpose  | Protect passwords, verify integrity             |
| Key Rule | Never store plain passwords, always hash + salt |

# Digital Signatures and Signing

## What Is a Digital Signature?

A **digital signature** is a **cryptographic method** used to **verify the authenticity, integrity, and origin** of digital data (such as a document, message, or software package). It’s like a **digital equivalent of a handwritten signature**, but far more secure and tamper-evident.

## Key Properties of Digital Signatures

| Property            | Description                                       |
| ------------------- | ------------------------------------------------- |
| **Authentication**  | Confirms the identity of the sender (signer)      |
| **Integrity**       | Confirms the data has not been altered            |
| **Non-repudiation** | The signer **cannot deny** having signed the data |

## How Digital Signing Works (Asymmetric Cryptography)

Digital signatures rely on **public key cryptography (PKI)** using a **key pair**:

- **Private Key**: Used to **sign** the data
- **Public Key**: Used to **verify** the signature

### Signing Process:

1. Generate a **hash** (digest) of the message
2. Encrypt the hash using the **signer's private key**
3. Attach the resulting **digital signature** to the message

### Verification Process:

1. Decrypt the signature using the **signer’s public key**
2. Hash the received message again
3. Compare both hashes:
   - If they match → the message is authentic and unchanged
   - If not → the message is either tampered or forged

## Digital Signature Example (Simplified)

```
Original Message: "Transfer $100 to Alice"
Hash: SHA-256("Transfer $100 to Alice") → abc123...

Signature: encrypt(abc123..., private_key_sender)

Sent: [Message + Signature]

Receiver:
- Verifies: decrypt(signature, public_key_sender) == SHA-256(message)
```

## Algorithms Commonly Used

| Algorithm | Type       | Notes                                      |
| --------- | ---------- | ------------------------------------------ |
| RSA       | Asymmetric | Widely used; supports encryption + signing |
| DSA       | Asymmetric | U.S. Digital Signature Algorithm           |
| ECDSA     | Asymmetric | ECC-based; faster and smaller signatures   |
| EdDSA     | Asymmetric | Modern, secure, and fast signature scheme  |

## Real-World Use Cases

- Email security (e.g., PGP, S/MIME)

- Code signing (e.g., software updates, drivers)

- Document signing (e.g., PDFs, contracts)

- TLS/SSL certificates

- Blockchain transactions

- AWS API request signing (e.g., Signature Version 4)

## Digital Signatures vs. Hashing

| Feature          | Digital Signature              | Hashing                    |
| ---------------- | ------------------------------ | -------------------------- |
| **Purpose**      | Prove authenticity + integrity | Verify data integrity only |
| **Key Required** | Yes (public/private key pair)  | No                         |
| **Reversible**   | Yes (via public key)           | No (one-way)               |

## Digital Signatures in AWS

- **AWS KMS**: Use asymmetric keys to digitally sign data

- **AWS CloudTrail**: Digitally signs logs for integrity verification

- **Code signing for Lambda**: Verify the source and integrity of function code

- **IAM SigV4**: Signs API requests for secure communication

## Summary

| Aspect          | Details                                                       |
| --------------- | ------------------------------------------------------------- |
| Goal            | Verify who sent data and that it hasn’t been altered          |
| Method          | Use private key to sign, public key to verify                 |
| Core Algorithms | RSA, ECDSA, EdDSA                                             |
| Key Advantages  | Integrity, authenticity, non-repudiation                      |
| AWS Tools       | AWS KMS, CloudTrail, Lambda code signing, API request signing |

# In-Transit vs. At-Rest Encryption

Encryption is essential for protecting sensitive data in cloud environments. It can be applied at different stages of data handling:

- **In-Transit**: When data is **moving** between systems
- **At-Rest**: When data is **stored** on disk or in a database

## In-Transit Encryption

### What It Is:

**In-Transit Encryption** protects data **while it is being transmitted** across networks — such as between a client and server, or between AWS services.

### Purpose:

- Prevents **eavesdropping**, **man-in-the-middle (MITM)** attacks, and **data tampering**
- Ensures confidentiality and integrity during communication

### Common Technologies:

| Protocol         | Description                                                              |
| ---------------- | ------------------------------------------------------------------------ |
| **TLS/SSL**      | Transport Layer Security for HTTPS, SMTP, IMAP, etc.                     |
| **VPNs**         | Encrypted tunnels for private communication                              |
| **IPsec**        | Encryption at the IP layer                                               |
| **AWS-specific** | AWS PrivateLink, VPC Peering (for secure communication between services) |

### AWS Examples:

- **S3 HTTPS endpoints** (TLS 1.2)
- **AWS API Gateway** using SSL
- **AWS Transfer Family** with SFTP
- **RDS database connections** over SSL

## At-Rest Encryption

### What It Is:

**At-Rest Encryption** protects data **when stored** on physical media like disks, databases, backups, or object storage.

### Purpose:

- Protects data in case of unauthorized physical access, disk theft, or data exfiltration
- Helps meet compliance standards (e.g., PCI-DSS, HIPAA, GDPR)

### Common Technologies:

| Type                                    | Description                                      |
| --------------------------------------- | ------------------------------------------------ |
| **AES-256**                             | Industry-standard symmetric encryption algorithm |
| **TDE**                                 | Transparent Data Encryption for databases        |
| **File-level or disk-level encryption** | Encrypt entire file systems or volumes           |

### AWS Examples:

| Service      | Encryption Tool                      |
| ------------ | ------------------------------------ |
| **S3**       | SSE-S3, SSE-KMS, or Client-side AES  |
| **EBS**      | KMS-based volume encryption          |
| **RDS**      | Storage-level encryption via AWS KMS |
| **DynamoDB** | Encryption at rest with KMS          |
| **Redshift** | Node-level encryption with KMS       |

## Comparison Table

| Feature            | In-Transit Encryption                 | At-Rest Encryption                         |
| ------------------ | ------------------------------------- | ------------------------------------------ |
| Protects Against   | MITM attacks, packet sniffing         | Data theft, physical access                |
| When It Applies    | During data transmission              | While stored on disk                       |
| Key Technologies   | TLS/SSL, IPsec, VPN                   | AES-256, KMS, TDE                          |
| Visibility to User | Happens during communication          | Transparent (handled by storage layer)     |
| AWS Examples       | HTTPS for S3/API Gateway, SSL for RDS | S3 SSE-KMS, RDS encryption, EBS encryption |

## Best Practices

- **Always encrypt data both at-rest and in-transit**
- Use **AWS KMS** to manage and rotate encryption keys
- Enforce **TLS-only connections** for AWS services
- Monitor encryption compliance using **AWS Config Rules**
- Store encryption keys securely (use customer-managed keys when needed)

## Summary

| Encryption Type | Data State | Goal                 | AWS Tools                          |
| --------------- | ---------- | -------------------- | ---------------------------------- |
| In-Transit      | Moving     | Secure communication | TLS, SSL, PrivateLink, VPC Peering |
| At-Rest         | Stored     | Secure data storage  | KMS, SSE-S3, EBS encryption, TDE   |

# Compliance Programs

**AWS Compliance Programs** are a set of **standards, certifications, regulations, and frameworks** that AWS aligns with to help customers meet **industry-specific security, privacy, and governance requirements**.

These programs demonstrate that AWS adheres to **global best practices** in information security, making it easier for organizations to build **compliant systems** in the cloud.

## Key AWS Compliance Categories

### 1. **Certifications and Attestations**

These are **third-party audits** that validate AWS’s implementation of security controls.

| Standard             | Description                                          |
| -------------------- | ---------------------------------------------------- |
| **ISO 27001**        | Information Security Management System (ISMS)        |
| **ISO 27017**        | Cloud-specific information security controls         |
| **ISO 27018**        | Protection of personal data in the cloud             |
| **SOC 1**            | Controls over financial reporting                    |
| **SOC 2**            | Controls for security, availability, confidentiality |
| **SOC 3**            | Public summary of SOC 2                              |
| **PCI DSS**          | Payment Card Industry Data Security Standard         |
| **FedRAMP**          | U.S. government cloud security authorization         |
| **IRAP (Australia)** | Government cloud security compliance                 |

### 2. **Laws, Regulations, and Privacy**

These include regional or national laws for data protection and privacy.

| Regulation            | Description                                         |
| --------------------- | --------------------------------------------------- |
| **GDPR (EU)**         | General Data Protection Regulation                  |
| **HIPAA (U.S.)**      | Health Insurance Portability and Accountability Act |
| **CCPA (California)** | California Consumer Privacy Act                     |
| **ITAR (U.S.)**       | International Traffic in Arms Regulations           |
| **FERPA (U.S.)**      | Student education record privacy                    |

> AWS provides infrastructure that can support these frameworks, but **compliance is a shared responsibility** between AWS and the customer.

### 3. **Industry and Regional Programs**

Compliance with specialized industry or government standards.

| Program                 | Focus Area                                   |
| ----------------------- | -------------------------------------------- |
| **CJIS**                | U.S. Criminal Justice Information Services   |
| **FIPS 140-2**          | U.S. Federal cryptographic standards         |
| **MTCS (Singapore)**    | Multi-Tier Cloud Security                    |
| **GxP (Life Sciences)** | Good Practice compliance for pharmaceuticals |
| **K-ISMS (Korea)**      | Information security for Korea               |
| **HITRUST**             | U.S. healthcare compliance framework         |

## AWS Artifact: Access Compliance Reports

**AWS Artifact** is a self-service portal where customers can:

- View and download **compliance reports** and **agreements**
- Access documents like **SOC 1/2/3**, **ISO certifications**, and **PCI reports**
- Accept **HIPAA Business Associate Addendums (BAA)** and other agreements

## Shared Responsibility Model & Compliance

AWS compliance programs apply to the **cloud infrastructure** (i.e., security **of** the cloud).

As a customer, you're responsible for:

| You (Customer)           | AWS                                  |
| ------------------------ | ------------------------------------ |
| Data classification      | Physical data center security        |
| Application security     | Hardware and software patching       |
| User identity management | Network infrastructure configuration |
| Encryption configuration | Compliance with underlying services  |

## Tools to Help With Compliance

| Tool/Service          | Purpose                                     |
| --------------------- | ------------------------------------------- |
| **AWS Config**        | Track configuration compliance              |
| **AWS Security Hub**  | Centralize security and compliance findings |
| **AWS Audit Manager** | Automate evidence collection for audits     |
| **Amazon Macie**      | Discover and classify sensitive data        |
| **AWS Organizations** | Enforce governance at scale                 |
| **AWS Control Tower** | Set up secure, multi-account landing zones  |

## Summary

| Compliance Type             | Examples                                          |
| --------------------------- | ------------------------------------------------- |
| **Certifications**          | ISO 27001, SOC 2, PCI DSS                         |
| **Regulations**             | GDPR, HIPAA, CCPA                                 |
| **Industry-Specific**       | FedRAMP, HITRUST, CJIS, IRAP                      |
| **Customer Responsibility** | Data security, access controls, application logic |
| **AWS Tools**               | Artifact, Audit Manager, Config, Security Hub     |

# Penetration Testing (Pen Testing)

**Penetration Testing**, also known as **pen testing**, is a **simulated cyberattack** against a system, application, or network to **identify security vulnerabilities** before real attackers can exploit them.

It involves ethical hackers attempting to breach a system’s defenses using the same techniques as malicious actors, helping organizations assess and improve their security posture.

## Objectives of Pen Testing

- **Identify vulnerabilities** that may not be caught by automated tools
- **Validate existing security controls**
- **Demonstrate real-world risk** of specific weaknesses
- **Meet compliance requirements** (e.g., PCI DSS, ISO 27001)
- **Provide actionable recommendations** to remediate risks

## Types of Penetration Testing

| Type                   | Description                                                        |
| ---------------------- | ------------------------------------------------------------------ |
| **External Testing**   | Tests assets exposed to the internet (e.g., websites, APIs)        |
| **Internal Testing**   | Simulates an attack from within the network (e.g., insider threat) |
| **Web App Testing**    | Targets web applications for XSS, SQLi, auth flaws, etc.           |
| **Wireless Testing**   | Assesses Wi-Fi networks and connected devices                      |
| **Social Engineering** | Tests human factors (e.g., phishing, pretexting)                   |
| **Physical Testing**   | Attempts to access data centers or offices physically              |

## Pen Testing vs Vulnerability Scanning

| Aspect    | Pen Testing                                   | Vulnerability Scanning             |
| --------- | --------------------------------------------- | ---------------------------------- |
| Approach  | Manual, adversarial simulation                | Automated tool-based analysis      |
| Depth     | Deep and focused                              | Broad and surface-level            |
| Goal      | Exploit and validate vulnerabilities          | Identify known vulnerabilities     |
| Tools     | Custom scripts, frameworks (Metasploit, Burp) | Scanners (Nessus, Qualys, OpenVAS) |
| Frequency | Periodic (quarterly/annually)                 | Continuous or monthly              |

## Stages of a Penetration Test

1. **Planning and Reconnaissance**

   - Define scope and objectives
   - Gather information (e.g., domain names, IPs)

2. **Scanning**

   - Identify open ports, services, and vulnerabilities

3. **Exploitation**

   - Attempt to gain access or escalate privileges

4. **Post-Exploitation**

   - Test persistence, data access, lateral movement

5. **Reporting**
   - Document findings, risk levels, and remediation steps

## Penetration Testing in AWS

AWS **allows penetration testing** of your cloud resources, but you must follow **their policy**.

### AWS Pen Testing Rules:

#### **Allowed Without Prior Approval**:

- EC2 instances, RDS, CloudFront, Aurora, API Gateway, Lambda, etc.

#### **Disallowed**:

- Testing against AWS infrastructure (e.g., DNS, S3 endpoints you don’t own)
- Denial of Service (DoS) or Distributed DoS (DDoS)
- Port flooding, protocol flooding, or resource exhaustion
- AWS has a dedicated page for Pen Test Policy.

## Tools Commonly Used in Pen Testing

| Category           | Tools                                     |
| ------------------ | ----------------------------------------- |
| Reconnaissance     | Nmap, Recon-ng, Shodan                    |
| Exploitation       | Metasploit, Cobalt Strike                 |
| Web Testing        | Burp Suite, OWASP ZAP                     |
| Password Attacks   | Hydra, John the Ripper, Hashcat           |
| Social Engineering | Gophish, SET (Social Engineering Toolkit) |

## Best Practices

- Always have **written permission** before testing
- Clearly define **scope, rules of engagement, and goals**
- **Segment production from test environments**
- Address and **remediate vulnerabilities promptly**
- Regularly repeat tests and **track improvements over time**

## Summary

| Attribute    | Details                                                                       |
| ------------ | ----------------------------------------------------------------------------- |
| Purpose      | Simulate real-world attacks to find weaknesses                                |
| Methods Used | Manual testing, ethical hacking techniques                                    |
| Key Benefits | Risk reduction, compliance, proactive defense                                 |
| AWS Policy   | Pen testing is allowed for your resources, but certain attacks are prohibited |
| Outcome      | Detailed report with vulnerabilities and fixes                                |

# AWS Artifact

**AWS Artifact** is a **self-service portal** that provides **on-demand access to AWS compliance reports and agreements**. It helps customers understand and demonstrate the security and compliance of AWS cloud infrastructure and services.

AWS Artifact is designed for **auditors, compliance teams, and security professionals** who need to access evidence for **regulatory compliance, certifications, and third-party attestations**.

## Key Features of AWS Artifact

### 1. **Compliance Reports**

- Download audit artifacts like **SOC reports, ISO certifications**, and **PCI DSS** attestations.
- Use these documents to support your own audits or assessments.

### 2. **Agreements**

- Accept and manage **legal agreements** with AWS, including:
  - **Business Associate Addendum (BAA)** for HIPAA compliance
  - **Nondisclosure Agreements (NDA)**
  - **GDPR Data Processing Addendum (DPA)**

### 3. **No Additional Cost**

- AWS Artifact is included at **no extra cost** for all AWS accounts.

## Types of Documents Available

| Category               | Examples                         |
| ---------------------- | -------------------------------- |
| **Certifications**     | ISO 27001, ISO 27017, ISO 27018  |
| **Attestations**       | SOC 1, SOC 2, SOC 3, PCI DSS     |
| **Agreements**         | HIPAA BAA, GDPR DPA, CJIS, FERPA |
| **Regulatory Reports** | FedRAMP, IRAP, MTCS, K-ISMS      |

## How to Use AWS Artifact

1. Log in to the **AWS Management Console**.
2. Navigate to **AWS Artifact**.
3. Choose between:
   - **Reports** (view/download compliance documents)
   - **Agreements** (review and accept agreements)
4. Download selected documents in **PDF format** for your internal use

## AWS Artifact Agreements Dashboard

- Track who in your organization has accepted which agreements
- Download signed agreements for auditing and legal purposes
- Review terms and conditions for services with sensitive data

## Benefits of Using AWS Artifact

- **Simplifies compliance audits** by providing trusted documentation
- **Saves time** by removing the need for manual AWS compliance evidence requests
- Supports compliance with **standards like GDPR, HIPAA, SOC, ISO, PCI**
- Increases **transparency** between AWS and its customers

## AWS Artifact vs Other Security Tools

| Feature                        | AWS Artifact | AWS Config / Security Hub     |
| ------------------------------ | ------------ | ----------------------------- |
| Access Compliance Docs         | Yes          | No                            |
| Accept Legal Agreements        | Yes          | No                            |
| Track Configuration Compliance | No           | Yes                           |
| Detect Threats                 | No           | Yes (Security Hub, GuardDuty) |

## Summary

| Feature          | Details                                         |
| ---------------- | ----------------------------------------------- |
| Purpose          | Access compliance reports and manage agreements |
| Scope            | Global AWS services and data centers            |
| Format           | PDF downloads, viewable in console              |
| Common Use Cases | Audits, risk assessments, compliance evidence   |
| Pricing          | Free (included in AWS account)                  |

# Amazon Inspector

**Amazon Inspector** is an **automated vulnerability management** service from AWS that continuously scans your AWS workloads for **security vulnerabilities** and **deviation from best practices**. It helps you:

- Detect **CVE-based software flaws**
- Identify **unpatched operating systems**
- Assess **network exposure**
- Enforce **system hardening**

Inspector is essential for maintaining **cloud workload security** and supporting **compliance** with standards like PCI DSS, ISO 27001, and CIS benchmarks.

## Key Features

| Feature                                | Description                                                |
| -------------------------------------- | ---------------------------------------------------------- |
| **Automated Scanning**                 | Continuously scans EC2, ECR (container images), and Lambda |
| **CVE Detection**                      | Detects known vulnerabilities using CVE databases          |
| **Network Reachability**               | Identifies exposed ports and services                      |
| **System Hardening Checks**            | Verifies alignment with security hardening best practices  |
| **Event-Driven Scanning**              | Re-scans when code, config, or packages change             |
| **Integration with AWS Organizations** | Centralized management across accounts                     |

## What Resources Can It Scan?

| AWS Resource Type | Checks Performed                              |
| ----------------- | --------------------------------------------- |
| **Amazon EC2**    | OS CVEs, software flaws, CIS hardening checks |
| **Amazon ECR**    | CVEs in container images                      |
| **AWS Lambda**    | CVEs in dependencies for supported runtimes   |

## What Is System Hardening?

**System hardening** is the process of **securing a system by reducing its attack surface**. It involves:

- Removing unnecessary software and services
- Enforcing strong configuration baselines
- Disabling unused ports and protocols
- Applying least privilege principles

Amazon Inspector integrates hardening checks for **Amazon EC2 instances**, evaluating configurations against **security benchmarks** like the **CIS AWS Foundations Benchmark**.

### Hardening Examples Checked by Inspector:

- Is SSH access restricted?
- Are password policies enforced?
- Are root login and public access disabled?
- Are OS-level services configured securely?

## How Amazon Inspector Works

1. **Enable Inspector** from the AWS Console
2. **Resources are automatically discovered** (EC2, ECR, Lambda)
3. Inspector **scans continuously** for:
   - CVEs
   - Network exposure
   - Hardening compliance
4. **Findings are generated**, scored, and available via console or APIs
5. Findings can be **integrated with Security Hub or EventBridge**

## Risk Scoring and Prioritization

Each finding receives a **risk score** based on:

- **CVSS severity**
- **Exploitability**
- **Public exposure (network reachability)**
- **Resource context** (e.g., production vs dev)

## Integration with Other AWS Services

| AWS Service            | Benefit                                          |
| ---------------------- | ------------------------------------------------ |
| **AWS Security Hub**   | Centralized view of Inspector and other findings |
| **Amazon EventBridge** | Automate alerts or remediation                   |
| **AWS Organizations**  | Centralized Inspector configuration at scale     |
| **AWS Config**         | Track compliance drift with config rules         |

## Pricing

Amazon Inspector charges per resource type and scan frequency:

- EC2 instances (per host/month)
- Container image scans (per image)
- Lambda function scans (per deployment)

## Summary

| Attribute         | Details                                                  |
| ----------------- | -------------------------------------------------------- |
| Purpose           | Continuous vulnerability management and hardening checks |
| Supports          | EC2, ECR, Lambda                                         |
| Scans For         | CVEs, network exposure, CIS compliance                   |
| Highlights        | Event-driven, auto-discovery, AWS-native integration     |
| Hardening Support | Checks against secure configuration baselines            |

## Getting Started

1. Go to **Amazon Inspector Console**
2. Click **Enable Inspector**
3. Inspector will automatically begin scanning supported resources

# DDoS (Distributed Denial of Service)

A **DDoS (Distributed Denial of Service)** attack is a malicious attempt to **disrupt the normal traffic** of a targeted server, service, or network by **overwhelming it with a flood of internet traffic** from multiple sources.

Unlike a regular DoS attack (from one source), a DDoS attack uses **hundreds or thousands of devices**, often part of a **botnet** — a network of infected computers or IoT devices controlled by an attacker.

## Goal of a DDoS Attack

- **Make services unavailable** to legitimate users
- Cause **downtime**, **revenue loss**, or **reputation damage**
- Sometimes used as a **distraction** while another attack occurs (e.g., data theft)

## Common Types of DDoS Attacks

| Type                   | Description                                                |
| ---------------------- | ---------------------------------------------------------- |
| **Volumetric Attacks** | Floods the network with massive traffic (measured in Gbps) |
| **Protocol Attacks**   | Exploits weaknesses in layer 3/4 protocols (e.g., TCP SYN) |
| **Application Layer**  | Targets web servers or apps with slow or complex requests  |

### Examples:

- **UDP Flood** – Sends large numbers of UDP packets to random ports
- **SYN Flood** – Abuses TCP handshake by sending a flood of incomplete connections
- **HTTP Flood** – Sends legitimate-looking HTTP requests to overload a web server
- **DNS Amplification** – Uses misconfigured DNS servers to reflect and amplify traffic

## DDoS in the Cloud

Cloud environments are not immune to DDoS attacks, but providers like AWS offer **scalable defenses** to absorb and mitigate attacks.

## AWS Services to Protect Against DDoS

| AWS Service                | Description                                         |
| -------------------------- | --------------------------------------------------- |
| **AWS Shield**             | DDoS protection service (Standard & Advanced tiers) |
| **AWS WAF**                | Web Application Firewall to block malicious traffic |
| **CloudFront**             | CDN to absorb and filter edge traffic               |
| **Route 53**               | Scalable DNS with built-in DDoS resilience          |
| **Elastic Load Balancing** | Automatically distributes traffic across targets    |

### AWS Shield Tiers:

- **Shield Standard**: Automatically included with AWS services, protects against common Layer 3/4 attacks.
- **Shield Advanced**:
  - Real-time attack detection and mitigation
  - 24/7 access to the AWS DDoS Response Team (DRT)
  - Financial protections (DDoS cost protection)
  - Visibility via AWS WAF and CloudWatch

## Signs of a DDoS Attack

- Unexpected spikes in traffic
- Increased latency or timeout errors
- Services becoming unresponsive
- CPU/network resource saturation

## Best Practices to Mitigate DDoS

- Use **AWS Shield Standard or Advanced**
- Place resources behind **CloudFront and ELB**
- Implement **rate limiting** and **WAF rules**
- Use **Auto Scaling** to absorb traffic surges
- Monitor traffic patterns via **CloudWatch and VPC Flow Logs**

## Summary

| Attribute          | Details                                                 |
| ------------------ | ------------------------------------------------------- |
| Definition         | Distributed attempt to exhaust server/network resources |
| Goal               | Disrupt service availability                            |
| Attack Sources     | Botnets, compromised devices, spoofed traffic           |
| AWS Defenses       | Shield, WAF, CloudFront, Route 53, ELB                  |
| Mitigation Tactics | Rate limiting, scaling, filtering, geoblocking          |

# AWS Shield

**AWS Shield** is a **managed Distributed Denial of Service (DDoS) protection service** from Amazon Web Services that safeguards applications running on AWS from **network and application layer attacks**.

Shield is designed to protect against common and large-scale DDoS attacks that could impact **availability, performance, or uptime** of your applications.

## AWS Shield Tiers

AWS Shield is offered in **two service levels**:

### 1. **AWS Shield Standard**

- **Free** and automatically enabled for all AWS customers.
- Protects against **common, most frequent DDoS attacks** at network (Layer 3) and transport (Layer 4) levels.
- Automatically defends services like:
  - Amazon CloudFront
  - Elastic Load Balancing (ELB)
  - Amazon Route 53
  - AWS Global Accelerator

### 2. **AWS Shield Advanced**

- **Paid service** offering enhanced protection for high-risk or mission-critical workloads.
- Includes:
  - Protection against larger and more **sophisticated attacks**
  - Real-time attack visibility through **CloudWatch metrics**
  - 24/7 access to the **AWS DDoS Response Team (DRT)**
  - **WAF integration** for automated application-layer defense
  - **Cost protection** for scaling during attack (DDoS Cost Protection)

## Shield Standard vs Shield Advanced

| Feature                      | Shield Standard | Shield Advanced                     |
| ---------------------------- | --------------- | ----------------------------------- |
| Cost                         | Free            | Paid (based on usage and regions)   |
| Protection Level             | Common attacks  | Sophisticated, large-scale attacks  |
| Application Layer Protection | No              | Yes (via WAF integration)           |
| 24/7 Response Team Access    | No              | Yes                                 |
| Attack Visibility            | Limited         | Real-time via CloudWatch            |
| DDoS Cost Protection         | No              | Yes                                 |
| Reports and Forensics        | Basic logs      | Detailed reports, forensics support |

## How AWS Shield Works

1. **Traffic Monitoring**:
   - Continuously analyzes incoming traffic to AWS services.
2. **Anomaly Detection**:
   - Uses traffic baselines and anomaly patterns to identify threats.
3. **Mitigation**:
   - Automatically absorbs and filters attack traffic without manual intervention.
4. **Reporting**:
   - Logs findings in CloudWatch (Advanced only), and alerts security teams.

## Services Protected by AWS Shield

- **CloudFront** (CDN edge)
- **Application Load Balancer (ALB)**
- **Network Load Balancer (NLB)**
- **Amazon Route 53** (DNS)
- **AWS Global Accelerator**
- **Elastic IPs** (if enrolled in Shield Advanced)

## Use Cases

- Protecting **public-facing web applications**
- Mitigating attacks on **API Gateway endpoints**
- Securing **DNS services** via Route 53
- Defending critical infrastructure for **financial, healthcare, or e-commerce applications**

## Best Practices with AWS Shield

- Use **CloudFront and WAF** to absorb and filter traffic at the edge
- Enable **rate limiting and geo-blocking** rules in AWS WAF
- Use **Amazon Route 53** instead of third-party DNS providers
- **Enroll Elastic IPs** in Shield Advanced for custom applications
- Integrate **AWS Firewall Manager** for organization-wide policies

## Summary

| Attribute           | Details                                              |
| ------------------- | ---------------------------------------------------- |
| Service Type        | Managed DDoS protection                              |
| Pricing Tiers       | Standard (Free), Advanced (Paid)                     |
| Key Benefits        | Uptime protection, real-time alerts, DDoS mitigation |
| Key Integration     | WAF, CloudFront, Route 53, ELB                       |
| Who Needs Advanced? | Enterprises, critical workloads, compliance-driven   |

# Amazon GuardDuty

**Amazon GuardDuty** is a **threat detection service** that continuously monitors your AWS accounts, workloads, and data for **malicious activity**, **unauthorized behavior**, and **potential security threats**.

GuardDuty uses **machine learning**, **anomaly detection**, and **threat intelligence feeds** to detect issues like:

- Compromised IAM credentials
- Unusual API calls
- Cryptocurrency mining
- Communications with known malicious IPs or domains

It helps AWS users detect and respond to threats **without needing to deploy or manage infrastructure**.

## Key Features

| Feature                      | Description                                        |
| ---------------------------- | -------------------------------------------------- |
| **Continuous Monitoring**    | Scans AWS accounts, logs, and workloads 24/7       |
| **Threat Intelligence**      | Uses AWS, CrowdStrike, and Proofpoint threat feeds |
| **No Agents Required**       | Fully managed; no installation needed              |
| **Multi-Account Support**    | Centralized view across all AWS accounts           |
| **Findings Dashboard**       | View, analyze, and act on findings in real-time    |
| **Security Hub Integration** | Forward alerts for centralized compliance          |

## What Does GuardDuty Analyze?

| Source                            | Description                                |
| --------------------------------- | ------------------------------------------ |
| **AWS CloudTrail**                | API calls and user activity                |
| **VPC Flow Logs**                 | Network traffic patterns and connections   |
| **DNS Logs**                      | Outbound DNS queries from EC2 and Lambda   |
| **S3 Data Events**                | Access patterns and permission misuses     |
| **EKS Audit Logs** (Optional)     | Detect threats in Kubernetes control plane |
| **Malware Protection** (Optional) | Scans EC2 workloads for active malware     |

## Common Threats Detected

- EC2 instance connecting to a known **botnet** or **command-and-control server**
- IAM user performing **suspicious API actions** (e.g., disabling CloudTrail)
- Large data exfiltration attempts from S3
- Unusual geographic access patterns
- Root user usage from unknown IPs
- EC2 instance involved in **crypto mining**

## How GuardDuty Works

1. **Enable GuardDuty** (one click in console or via CLI)
2. It **automatically analyzes logs** from multiple AWS sources
3. It uses **ML and threat intelligence** to detect suspicious behavior
4. Generates **findings** categorized by severity (low, medium, high)
5. Findings can be sent to **CloudWatch Events**, **Security Hub**, or **SIEMs**

## Pricing

- **Pay-as-you-go** pricing model based on:
  - Volume of logs processed (CloudTrail, VPC Flow Logs, DNS logs)
  - Number of S3 and EKS data sources
  - Malware scan requests

## GuardDuty vs Similar AWS Services

| Service          | Focus                                            |
| ---------------- | ------------------------------------------------ |
| **GuardDuty**    | Threat detection (logs + intelligence)           |
| **Security Hub** | Aggregates security alerts from multiple sources |
| **Inspector**    | Vulnerability scanning (CVE detection)           |
| **Macie**        | Data classification and privacy risks            |
| **CloudTrail**   | Records AWS API activity (raw logs)              |

## Best Practices

- Enable GuardDuty across **all accounts** using **AWS Organizations**
- **Automate response** to critical findings using Lambda via EventBridge
- Combine with **Security Hub** for unified threat visibility
- Enable **malware protection** and **S3 protection** for deeper coverage
- Forward findings to **SIEM tools** or **ticketing systems** for workflow automation

## Summary

| Attribute      | Description                                                |
| -------------- | ---------------------------------------------------------- |
| Purpose        | Intelligent threat detection for AWS accounts & workloads  |
| Data Sources   | CloudTrail, VPC Flow Logs, DNS, S3, EKS, Malware scans     |
| Key Features   | ML-based detection, threat intel feeds, no agents required |
| Pricing        | Pay per GB analyzed and features enabled                   |
| Common Threats | Credential misuse, malware, data exfiltration, C2 traffic  |

## Getting Started

1. Go to **Amazon GuardDuty Console**
2. Click **Enable GuardDuty**
3. Findings will begin appearing automatically once enabled

# Amazon Macie

**Amazon Macie** is a **fully managed data security and privacy service** that uses **machine learning and pattern matching** to automatically **discover, classify, and protect sensitive data** in AWS — especially in **Amazon S3**.

It helps you identify **personally identifiable information (PII)** and other sensitive content like:

- Names, addresses
- Credit card numbers
- Government IDs (e.g., Aadhaar, SSN, PAN)
- Financial records
- API keys and credentials

## Key Features

| Feature                           | Description                                             |
| --------------------------------- | ------------------------------------------------------- |
| **Automatic Discovery**           | Continuously scans Amazon S3 buckets                    |
| **Sensitive Data Classification** | Detects PII, financial data, credentials, etc.          |
| **Custom Data Identifiers**       | Define your own regex-based patterns for scanning       |
| **Risk Scoring**                  | Flags high-risk objects (e.g., publicly accessible PII) |
| **Dashboards and Alerts**         | Visualize and respond to findings in the AWS Console    |
| **Integration with EventBridge**  | Automate remediation via Lambda workflows               |

## Supported Data Types

Macie can detect many types of **predefined sensitive data**, including:

- **Names, emails, and phone numbers**
- **Credit card numbers**
- **Social Security numbers**
- **AWS secret keys and access keys**
- **Custom-defined patterns** (e.g., employee ID formats)

## How Amazon Macie Works

1. **Enable Macie** in your AWS account (region-specific).
2. Macie **automatically discovers all S3 buckets** in your account.
3. You choose which buckets to scan and set **scan schedules** (one-time or periodic).
4. Macie **uses ML + pattern matching** to detect sensitive data.
5. Findings are sent to the **Macie console**, **EventBridge**, or **Security Hub**.

## Use Cases

- Discover and protect **PII for GDPR, HIPAA, or CCPA** compliance
- Detect **accidental exposure** of sensitive files in public S3 buckets
- Prevent **data leaks** and unintentional sharing
- Audit and enforce **data protection policies**
- Automate security response with **Lambda + EventBridge**

## Integration with Other AWS Services

| AWS Service           | Integration Purpose                                 |
| --------------------- | --------------------------------------------------- |
| **AWS Security Hub**  | Centralized alert visibility                        |
| **AWS EventBridge**   | Trigger remediation workflows (e.g., untag buckets) |
| **AWS Organizations** | Enable Macie across multiple accounts centrally     |
| **Amazon S3**         | Native bucket scanning and metadata usage           |
| **Amazon Athena**     | Query Macie results in large-scale data lakes       |

## Macie Findings

Each finding includes:

- **Severity level** (Low, Medium, High)
- **Type of sensitive data detected**
- **Object name and bucket**
- **Permissions** (e.g., public-read)
- **Timestamps**

## Pricing Overview

Macie pricing is based on:

1. **S3 bucket inventory evaluation** (monthly)
2. **S3 object scanning** (per GB)
3. **Number of findings generated**

## Macie vs Other AWS Security Tools

| Tool              | Focus Area                                       |
| ----------------- | ------------------------------------------------ |
| **Macie**         | Discovering and classifying sensitive data in S3 |
| **GuardDuty**     | Detecting threats and anomalous behavior         |
| **AWS Inspector** | Finding vulnerabilities in EC2, Lambda, ECR      |
| **Security Hub**  | Aggregating findings from all security services  |

## Summary

| Attribute         | Details                                              |
| ----------------- | ---------------------------------------------------- |
| Purpose           | Discover and protect sensitive data in Amazon S3     |
| Core Technologies | Machine learning, pattern matching                   |
| Detects           | PII, financial data, credentials, secrets            |
| Actions           | Risk scoring, finding generation, alerting           |
| Key Integrations  | Security Hub, EventBridge, Lambda, AWS Organizations |

## Getting Started with Macie

1. Go to the **Amazon Macie Console**
2. Click **Enable Macie** (regional)
3. Select **S3 buckets to scan**
4. Set up **scheduling** and **notification preferences**
5. Review **findings** and integrate with workflows

# AWS VPN (Virtual Private Network)

**AWS VPN** (Virtual Private Network) is a **secure, encrypted connection** between your on-premises network or remote client devices and your AWS infrastructure. It enables **private communication** over the public internet by using industry-standard IPsec VPN tunnels.

AWS VPN helps organizations **extend their existing networks** into the cloud securely, supporting **hybrid architectures**, **remote access**, and **compliance requirements**.

## Key Use Cases

- **Hybrid Cloud**: Securely connect on-premises data centers to AWS VPCs
- **Remote Workforce**: Provide remote employees encrypted access to cloud resources
- **Backup and DR**: Transfer data between on-prem and AWS securely
- **Migrate Workloads**: Enable secure migration of applications to the cloud

## Types of AWS VPN

### 1. **AWS Site-to-Site VPN**

- Connects your **on-premises network or data center** to an **Amazon VPC** over an **IPsec VPN tunnel**
- Requires a **customer gateway device** (e.g., firewall/router)
- Built on AWS **Virtual Private Gateway (VGW)** or **Transit Gateway**

**Key Features:**

- Redundant tunnels for high availability
- Supports **dynamic (BGP)** or **static routing**
- Encrypted using **IPsec/IKEv1 or IKEv2**

### 2. **AWS Client VPN**

- A **fully managed, elastic VPN service** that enables **remote users** to access AWS resources or on-prem networks securely
- Users connect via **OpenVPN-based clients**
- Integrates with **Active Directory, IAM, or mutual TLS auth**

**Key Features:**

- Scales automatically to thousands of users
- Provides **split-tunnel or full-tunnel options**
- Ideal for **remote workforces** and **BYOD environments**

## How It Works

### Site-to-Site VPN:

```
[ On-Prem Network ]
|
[ Customer Gateway (CGW) ]
|
⇅ Encrypted IPsec Tunnel
|
[ Virtual Private Gateway / Transit Gateway ]
|
[ Amazon VPC ]
```

### Client VPN:

```
[ Remote User Device ]
|
[ AWS Client VPN Endpoint ]
|
[ VPC / On-Prem Network ]
```

## Key Components

| Component                         | Description                                             |
| --------------------------------- | ------------------------------------------------------- |
| **Customer Gateway (CGW)**        | Your on-prem router or firewall                         |
| **Virtual Private Gateway (VGW)** | AWS side of the VPN for one VPC                         |
| **Transit Gateway (TGW)**         | Hub to connect multiple VPCs and on-prem sites          |
| **VPN Connection**                | The secure IPsec tunnel between AWS and your network    |
| **Client VPN Endpoint**           | Entry point for remote users connecting via VPN clients |

## AWS VPN vs Direct Connect

| Feature        | AWS VPN                    | AWS Direct Connect                      |
| -------------- | -------------------------- | --------------------------------------- |
| Transport Type | Internet (encrypted)       | Dedicated private fiber connection      |
| Latency        | Higher                     | Lower and more consistent               |
| Use Case       | Quick, secure connectivity | High-throughput, latency-sensitive apps |
| Cost           | Pay-as-you-go              | Higher fixed monthly costs              |
| Encryption     | Built-in with IPsec        | Optional, must be layered separately    |

## Best Practices

- Use **BGP with dynamic routing** for resiliency and failover
- Monitor tunnel health with **CloudWatch metrics**
- Implement **Network ACLs and Security Groups** for fine-grained access
- Use **Client VPN with IAM or SAML** for user-based policies
- Consider **Direct Connect + VPN** for redundancy

## Summary

| Attribute    | Details                                                |
| ------------ | ------------------------------------------------------ |
| Purpose      | Secure communication between AWS and external networks |
| Types        | Site-to-Site VPN, Client VPN                           |
| Encryption   | IPsec (AES-256, IKEv2)                                 |
| Auth Options | BGP, static IPs (Site-to-Site); AD, IAM, TLS (Client)  |
| Key Benefits | Secure, scalable, easy to deploy                       |

# IPsec (Internet Protocol Security)

## What Is IPsec?

**IPsec (Internet Protocol Security)** is a suite of **protocols and standards** used to **secure network communication** at the **IP layer (Layer 3)**. It provides **confidentiality, integrity, and authentication** for data sent between devices over untrusted networks like the internet.

IPsec is widely used in **VPNs (Virtual Private Networks)** — including **AWS Site-to-Site VPNs** — to establish **encrypted tunnels** between on-premises networks and cloud environments.

## Core Features of IPsec

| Feature            | Description                                                  |
| ------------------ | ------------------------------------------------------------ |
| **Encryption**     | Ensures data confidentiality using ciphers like AES          |
| **Integrity**      | Detects tampering via hashing (e.g., SHA-2)                  |
| **Authentication** | Confirms the identity of endpoints (via PSK or certificates) |
| **Anti-Replay**    | Prevents duplicate packets from being replayed               |
| **Key Exchange**   | Uses IKE (Internet Key Exchange) to negotiate keys           |

## IPsec Modes

### 1. **Transport Mode**

- Encrypts only the **payload** of the IP packet
- Original IP header remains visible
- Used in **end-to-end** encryption between hosts

### 2. **Tunnel Mode**

- Encrypts the **entire IP packet** (header + payload)
- A new IP header is added for routing
- Common in **VPNs**, including **AWS Site-to-Site VPN**

## IPsec Protocol Components

| Protocol                                 | Purpose                                            |
| ---------------------------------------- | -------------------------------------------------- |
| **AH (Authentication Header)**           | Provides integrity and authentication only         |
| **ESP (Encapsulating Security Payload)** | Provides encryption, integrity, and authentication |
| **IKE (Internet Key Exchange)**          | Negotiates keys and security parameters            |

## Use Cases

- **Site-to-site VPNs** (e.g., AWS, Cisco, Fortinet)
- **Remote access VPNs**
- **Secure communication over public networks**
- **Compliance** with data protection standards (e.g., HIPAA, PCI-DSS)

## Summary

| Attribute      | Details                                             |
| -------------- | --------------------------------------------------- |
| Full Name      | Internet Protocol Security                          |
| OSI Layer      | Layer 3 (Network Layer)                             |
| Core Protocols | AH, ESP, IKEv1/IKEv2                                |
| Key Features   | Encryption, integrity, authentication, key exchange |
| Common Mode    | Tunnel Mode (used in VPNs)                          |
| AWS Use Case   | AWS Site-to-Site VPN                                |

# AWS WAF (Web Application Firewall)

**AWS WAF** is a **Web Application Firewall** that helps protect your web applications from **common web exploits** and **malicious traffic**, such as:

- SQL injection (SQLi)
- Cross-site scripting (XSS)
- Bad bots
- HTTP flood attacks
- Unauthorized access attempts

It allows you to define **custom security rules** that control how incoming HTTP/HTTPS requests are processed by your web applications running on AWS.

## Key Features

| Feature                  | Description                                                 |
| ------------------------ | ----------------------------------------------------------- |
| **Custom Rule Sets**     | Create rules based on IP, headers, body, URI, query strings |
| **Managed Rule Groups**  | Pre-built rules from AWS and partners for OWASP Top 10      |
| **Bot Control**          | Detect and block common bots or scrapers                    |
| **Rate-Based Rules**     | Automatically block IPs sending too many requests           |
| **Regex Pattern Sets**   | Match specific request patterns using regular expressions   |
| **Real-Time Metrics**    | Monitor blocked/allowed requests via CloudWatch             |
| **Logging & Monitoring** | Detailed logs to S3, CloudWatch, or Kinesis for analysis    |

## How AWS WAF Works

1. **Deploy WAF on resources** like:

   - **Amazon CloudFront** (global CDN)
   - **Application Load Balancer (ALB)**
   - **Amazon API Gateway**
   - **AWS App Runner**

2. **Define Web ACLs (Access Control Lists)** that contain:

   - Rules (allow/block/count)
   - Rule groups (managed or custom)
   - Default action (allow or block)

3. WAF **inspects HTTP/S requests** before they reach your application and applies rules.

## Example Use Cases

- Block requests from **malicious IPs or countries**
- Throttle **high-frequency API calls** from a single IP
- Filter **SQLi/XSS injection attempts**
- Allow only **specific user-agent strings** (e.g., browsers only)
- Prevent bots from scraping content

## Managed Rule Groups

AWS provides preconfigured, regularly updated rule sets for quick deployment:

| Rule Group                       | Purpose                           |
| -------------------------------- | --------------------------------- |
| **AWSManagedRulesCommonRuleSet** | Protects against common threats   |
| **SQLiRuleSet**                  | SQL injection detection           |
| **XSSRuleSet**                   | Cross-site scripting protection   |
| **BotControlRuleSet**            | Blocks bad bots, allows good ones |
| **AnonymousIPList**              | Blocks Tor nodes, proxies, VPNs   |

You can also subscribe to **third-party managed rules** from AWS Marketplace.

## Rate-Based Rules

Allows you to set thresholds on the number of requests from a single IP address:

- Example: block any IP that sends **more than 1,000 requests in 5 minutes**

Useful for:

- Throttling brute-force login attempts
- Protecting APIs from abuse

## Integration with Other Services

| AWS Service              | Purpose                                  |
| ------------------------ | ---------------------------------------- |
| **CloudFront**           | Global WAF protection at the edge        |
| **ALB**                  | Protect internal and public web apps     |
| **API Gateway**          | Secure APIs against bad input            |
| **CloudWatch**           | Monitor and alert on WAF activity        |
| **AWS Firewall Manager** | Apply WAF rules across multiple accounts |

## Logging and Monitoring

- Enable **full request logs** to **Amazon S3**, **CloudWatch Logs**, or **Kinesis Data Firehose**
- View metrics like **allowed, blocked, counted requests**
- Create dashboards and alerts based on WAF activity

## AWS WAF vs AWS Shield

| Feature      | AWS WAF                                | AWS Shield                        |
| ------------ | -------------------------------------- | --------------------------------- |
| Purpose      | Protects web apps from Layer 7 attacks | Protects infrastructure from DDoS |
| Scope        | Application-level                      | Network/transport-level           |
| Custom Rules | Yes                                    | No                                |
| Bot Blocking | Yes (Bot Control)                      | No                                |

## Pricing Overview

- **No upfront cost**
- Pay for:
  - Number of **Web ACLs**
  - Number of **rules per ACL**
  - Number of **requests processed**

## Summary

| Attribute          | Description                                         |
| ------------------ | --------------------------------------------------- |
| Purpose            | Protects web apps from exploits and bad requests    |
| Deployment Targets | CloudFront, ALB, API Gateway, App Runner            |
| Key Features       | Custom rules, managed rules, rate limiting, logging |
| Use Cases          | OWASP protection, bot mitigation, geo blocking      |
| Management Options | Console, AWS CLI, SDKs, CloudFormation              |

# Hardware Security Module (HSM)

A **Hardware Security Module (HSM)** is a **specialized physical device** designed to securely generate, store, and manage **cryptographic keys**. HSMs are **tamper-resistant** and provide **high levels of physical and logical security**, ensuring that sensitive key material cannot be extracted or compromised.

HSMs are commonly used in industries with **strict security and compliance requirements** such as banking, healthcare, and government.

## Key Functions of an HSM

| Function                  | Description                                               |
| ------------------------- | --------------------------------------------------------- |
| **Key Generation**        | Securely generates cryptographic keys inside the hardware |
| **Key Storage**           | Stores keys in secure, non-exportable memory              |
| **Key Usage**             | Performs encryption/decryption, signing, and key exchange |
| **Key Rotation & Expiry** | Manages lifecycle of keys                                 |
| **Tamper Detection**      | Destroys keys if physical tampering is detected           |

## Benefits of Using an HSM

- **Physical security**: Designed to resist tampering, side-channel attacks, and probing
- **Regulatory compliance**: Meets standards like **FIPS 140-2 Level 3**, **PCI DSS**, **HIPAA**
- **Key sovereignty**: Ensures that cryptographic keys are controlled entirely by the organization
- **Non-exportable keys**: Keys never leave the HSM in plaintext form

## Cloud-Based HSM: AWS CloudHSM

**AWS CloudHSM** is a **fully managed HSM service** that allows you to run cryptographic operations using **dedicated FIPS 140-2 Level 3 validated hardware** in your own AWS VPC.

### Key Features of AWS CloudHSM

| Feature                | Description                                                  |
| ---------------------- | ------------------------------------------------------------ |
| **Dedicated HSMs**     | Each customer gets their own HSM hardware (not shared)       |
| **FIPS 140-2 Level 3** | Meets government and financial industry compliance standards |
| **Key Ownership**      | Full control of keys—AWS has no access                       |
| **Cluster Support**    | Can form HSM clusters across Availability Zones for HA       |
| **Client Libraries**   | PKCS#11, JCE, OpenSSL integrations supported                 |

## AWS CloudHSM vs AWS KMS

| Feature           | AWS CloudHSM                         | AWS KMS                               |
| ----------------- | ------------------------------------ | ------------------------------------- |
| **Key Ownership** | Customer-controlled                  | AWS-managed or customer-managed       |
| **FIPS Level**    | Level 3                              | Level 2 (default)                     |
| **Use Case**      | Compliance-heavy apps, root CA, etc. | Most general-purpose encryption needs |
| **Management**    | You manage clusters, users, access   | Fully managed by AWS                  |
| **Integration**   | PKCS#11, JCE, OpenSSL                | AWS SDK, CLI, services                |

## Common Use Cases for HSMs

- **Public Key Infrastructure (PKI)**: Securely storing root and intermediate certificate authority keys
- **Digital Signatures**: Signing sensitive documents, firmware, or transactions
- **Key Management**: Managing master encryption keys for databases or applications
- **Tokenization & Data Masking**: For payment systems or PII data protection
- **Hardware-backed multi-tenant systems**: Cloud services, authentication tokens

## Summary

| Attribute           | Description                                             |
| ------------------- | ------------------------------------------------------- |
| Purpose             | Secure cryptographic key generation, storage, and usage |
| Security Level      | High (Tamper-resistant, FIPS-certified)                 |
| Cloud Option        | AWS CloudHSM                                            |
| Benefits            | Compliance, key sovereignty, high trust                 |
| Common Alternatives | AWS KMS, third-party HSMs (Thales, SafeNet, YubiHSM)    |

# AWS KMS (Key Management Service)

**AWS Key Management Service (KMS)** is a **fully managed service** that enables you to **create, manage, and control cryptographic keys** used to protect your data across AWS services and custom applications.

It integrates with most AWS services to provide **encryption at rest and in transit**, using **FIPS 140-2 validated hardware** to secure your keys.

## Key Features

| Feature                          | Description                                                    |
| -------------------------------- | -------------------------------------------------------------- |
| **Centralized Key Management**   | Create and manage keys from a single service                   |
| **Encryption & Decryption APIs** | Encrypt/decrypt data directly using KMS or envelope encryption |
| **Auditability**                 | Integrated with AWS CloudTrail for full visibility             |
| **IAM-based Access Control**     | Fine-grained permissions on keys                               |
| **Automatic Key Rotation**       | Yearly rotation option for customer-managed keys               |
| **FIPS 140-2 Compliance**        | Uses secure hardware modules to protect key material           |
| **Multi-Region Keys**            | Replicate keys for disaster recovery and latency reduction     |

## Key Types in AWS KMS

| Key Type                         | Description                                               |
| -------------------------------- | --------------------------------------------------------- |
| **AWS-managed keys**             | Automatically created and managed by AWS for each service |
| **Customer-managed keys (CMKs)** | Created, owned, and controlled by you                     |
| **Asymmetric keys**              | RSA/ECC key pairs for signing and encryption              |
| **Symmetric keys**               | Default; AES-256 keys used with most AWS services         |
| **Multi-Region keys**            | CMKs that can be replicated across AWS regions            |

## How AWS KMS Works

1. A user or service **requests encryption** via AWS SDK/API.
2. KMS uses the **specified key** to encrypt the data or a data key.
3. The encrypted data (or data key) is returned and used by the calling application.
4. **Decryption requests** go through KMS with access policies applied.

## Envelope Encryption

KMS commonly uses **envelope encryption**:

- A **data key** is generated by KMS
- The data key encrypts your actual data (locally)
- The data key itself is encrypted with a **KMS key**
- Both the encrypted data and encrypted key are stored

This approach improves performance and security for large datasets.

## Services Integrated with AWS KMS

AWS KMS is deeply integrated with many AWS services:

| Service             | Encryption Role                             |
| ------------------- | ------------------------------------------- |
| **S3**              | Server-side encryption (SSE-KMS)            |
| **EBS**             | Volume encryption                           |
| **RDS**             | Database storage encryption                 |
| **Lambda**          | Environment variable and payload encryption |
| **CloudTrail**      | Log file encryption                         |
| **Secrets Manager** | Secure storage of secrets                   |
| **EKS**             | Encrypt Kubernetes secrets                  |

## Security and Access Control

- Use **IAM policies** to control who can use or manage keys
- Apply **key policies** for finer-grained control
- Enable **key rotation** for CMKs
- Monitor key usage with **CloudTrail logs**

## KMS vs CloudHSM

| Feature             | AWS KMS                    | AWS CloudHSM                       |
| ------------------- | -------------------------- | ---------------------------------- |
| Managed By          | AWS                        | Customer                           |
| FIPS Certification  | Level 2 (default)          | Level 3                            |
| Use Case            | General encryption needs   | Compliance-driven apps, root CAs   |
| API Simplicity      | Simple AWS-native APIs     | PKCS#11, JCE, OpenSSL integrations |
| Cost and Complexity | Lower and easier to manage | Higher control and cost            |

## Pricing

You pay for:

- **Key creation and storage**
- **Requests** (Encrypt, Decrypt, GenerateDataKey, etc.)
- **Custom key stores** (if using CloudHSM-backed keys)

## Summary

| Attribute        | Details                                             |
| ---------------- | --------------------------------------------------- |
| Purpose          | Manage encryption keys securely across AWS services |
| Key Types        | Symmetric (default), asymmetric, multi-region       |
| Access Control   | IAM + Key Policies                                  |
| Common Use Cases | Encrypt S3, RDS, EBS, Lambda, CloudTrail            |
| Compliance       | FIPS 140-2 validated hardware modules               |

# AWS CloudHSM

**AWS CloudHSM** is a **cloud-based hardware security module (HSM)** service that enables you to **generate, store, and use cryptographic keys** within **FIPS 140-2 Level 3 validated** hardware.

Unlike AWS KMS, CloudHSM gives you **exclusive access and full control** over your keys and the HSMs, helping meet strict **compliance**, **sovereignty**, and **regulatory requirements**.

## Key Features

| Feature                   | Description                                                 |
| ------------------------- | ----------------------------------------------------------- |
| **FIPS 140-2 Level 3**    | Meets highest security standards for government and finance |
| **Full Key Ownership**    | AWS cannot access your keys; you manage users and access    |
| **Dedicated Hardware**    | Each customer gets isolated HSMs, not shared with others    |
| **High Availability**     | Supports HSM clustering across multiple AZs                 |
| **PKCS#11, JCE, OpenSSL** | Compatible with industry-standard crypto libraries          |
| **Backup and Restore**    | Supports encrypted backups for disaster recovery            |

## Use Cases

- **Digital signing** (e.g., document signing, code signing)
- **Public Key Infrastructure (PKI)**
- **Database TDE key storage** (e.g., Oracle, SQL Server)
- **SSL/TLS offloading**
- **Root certificate authority (CA)**
- **Tokenization and data masking in financial apps**

## CloudHSM vs AWS KMS

| Feature                 | AWS CloudHSM                         | AWS KMS                        |
| ----------------------- | ------------------------------------ | ------------------------------ |
| **Key Control**         | Full customer ownership              | Shared responsibility with AWS |
| **FIPS Level**          | Level 3                              | Level 2 (default)              |
| **Compliance Use Case** | High-assurance, regulated industries | General-purpose encryption     |
| **Scalability**         | Manual cluster management            | Fully managed                  |
| **Interface**           | PKCS#11, JCE, OpenSSL                | AWS SDK / API                  |

## How AWS CloudHSM Works

1. You **provision an HSM cluster** in your VPC.
2. You connect to the HSMs using **client software** (via EC2).
3. You create and manage **HSM users, roles, and keys**.
4. Applications can access HSMs using **standard cryptographic libraries**.
5. AWS provides **monitoring and automatic patching**, but **cannot access your keys**.

## Architecture

```
[ Your EC2 Instances ]
|
PKCS#11 / OpenSSL / JCE
|
[ AWS CloudHSM Cluster ]
|
[ Dedicated HSM Instances in VPC ]
```

## Security and Compliance

- Supports **customer-controlled multi-tenant key management**
- Designed for **compliance-heavy industries**:
  - PCI DSS
  - HIPAA
  - FedRAMP High
  - GDPR
- Allows **secure auditing** and **user authentication** via crypto tokens

## Pricing Overview

AWS CloudHSM charges for:

- **HSM instances per hour**
- **Backup storage usage**

It’s more expensive than KMS but provides stronger guarantees and compliance alignment.

## Summary

| Attribute        | AWS CloudHSM                             |
| ---------------- | ---------------------------------------- |
| Service Type     | Dedicated hardware security module       |
| Key Control      | Full customer control                    |
| Compliance       | FIPS 140-2 Level 3                       |
| Interfaces       | PKCS#11, JCE, OpenSSL                    |
| Deployment Model | In VPC, one or more Availability Zones   |
| Best For         | Root CA, HSM-backed key storage, signing |


---
[← Previous](26.%20Billing,%20Pricing%20and%20Support.md) | [Next →](28.%20Variation%20Study.md)